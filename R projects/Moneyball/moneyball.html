<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="David Desquens">

<title>MoneyBall</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="moneyball_files/libs/clipboard/clipboard.min.js"></script>
<script src="moneyball_files/libs/quarto-html/quarto.js"></script>
<script src="moneyball_files/libs/quarto-html/popper.min.js"></script>
<script src="moneyball_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="moneyball_files/libs/quarto-html/anchor.min.js"></script>
<link href="moneyball_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="moneyball_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="moneyball_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="moneyball_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="moneyball_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<link href="moneyball_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="moneyball_files/libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">MoneyBall</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Helping Billy Beane (or Brad Pitt) to make it to the 2002 playoffs with the Oakland A’s</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>David Desquens </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="moneyball_title.jpg" class="img-fluid figure-img"></p>
</figure>
</div>
<section id="context-background" class="level2">
<h2 class="anchored" data-anchor-id="context-background">Context &amp; Background</h2>
<p><em>Source: <a href="https://en.wikipedia.org/wiki/Moneyball">Wikipedia</a></em></p>
<section id="rules-of-baseball" class="level4">
<h4 class="anchored" data-anchor-id="rules-of-baseball"><strong>Rules of Baseball</strong></h4>
<p>You don’t need to know much about Baseball to understand the analysis. If you’re totally unfamiliar with Baseball, check out this <a href="https://www.youtube.com/watch?v=0bKkGeROiPA">useful explanatory video!</a></p>
</section>
<section id="the-2002-oakland-as" class="level4">
<h4 class="anchored" data-anchor-id="the-2002-oakland-as"><strong>The 2002 Oakland A’s</strong></h4>
<p>The Oakland Athletics’ 2002 season was the team’s 35th in Oakland, California. It was also the 102nd season in franchise history. The Athletics finished first in the American League West with a record of 103-59.</p>
<p>The Athletics’ 2002 campaign ranks among the most famous in franchise history. Following the 2001 season, Oakland saw the departure of three key players (the lost boys). Billy Beane, the team’s general manager, responded with a series of under-the-radar free agent signings. The new-look Athletics, despite a comparative lack of star power, surprised the baseball world by besting the 2001 team’s regular season record. The team is most famous, however, for winning 20 consecutive games between August 13 and September 4, 2002. The Athletics’ season was the subject of Michael Lewis’ 2003 book Moneyball: The Art of Winning an Unfair Game (as Lewis was given the opportunity to follow the team around throughout that season).</p>
<p>This project is based off the book written by Michael Lewis (later turned into a movie - see <a href="https://youtu.be/yGf6LNWY9AI?si=zsLayKwV5YBw-Jqm">the magic moment</a>).</p>
</section>
<section id="moneyball-book" class="level4">
<h4 class="anchored" data-anchor-id="moneyball-book"><strong>Moneyball Book</strong></h4>
<p>The central premise of book <em>Moneyball</em> is that the collective wisdom of baseball insiders (including players, managers, coaches, scouts, and the front office) over the past century is subjective and often flawed. Statistics such as stolen bases, runs batted in, and batting average, typically used to gauge players, are relics of a 19th-century view of the game and the statistics available at that time. The book argues that the Oakland A’s’ front office took advantage of more analytical gauges of player performance to field a team that could better compete against richer competitors in Major League Baseball (MLB).</p>
<p>Rigorous statistical analysis had demonstrated that on-base percentage and slugging percentage are better indicators of offensive success, and the A’s became convinced that these qualities were cheaper to obtain on the open market than more historically valued qualities such as speed and contact. These observations often flew in the face of conventional baseball wisdom and the beliefs of many baseball scouts and executives.</p>
<p>By re-evaluating the strategies that produce wins on the field, the 2002 Athletics, with approximately US 44 million dollars in salary, were competitive with larger market teams such as the New York Yankees, who spent over US$125 million in payroll that same season.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="salary.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Because of the team’s smaller revenues, Oakland is forced to find players undervalued by the market, and their system for finding value in undervalued players has proven itself thus far. This approach brought the A’s to the playoffs in 2002 and 2003.</p>
<p>In this project we’ll work with some data and with the goal of trying to find replacement players for the ones lost at the start of the off-season - During the 2001–02 offseason, the team lost three key free agents to larger market teams: 2000 AL MVP Jason Giambi to the New York Yankees, outfielder Johnny Damon to the Boston Red Sox, and closer Jason Isringhausen to the St.&nbsp;Louis Cardinals.</p>
</section>
</section>
<section id="lets-get-started" class="level2">
<h2 class="anchored" data-anchor-id="lets-get-started">Let’s get started!</h2>
<p>The main goal of this project is to help the Oakland A’s recruit under-valued players!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Moneyball.jpg" class="img-fluid figure-img"></p>
</figure>
</div>
<section id="data-prep" class="level4">
<h4 class="anchored" data-anchor-id="data-prep"><strong>Data prep</strong></h4>
<p>We’ll be using data from <a href="http://www.seanlahman.com">Sean Lahaman’s Website</a> a very useful source for baseball statistics. The documentation for the csv files that we will be using is located in the readme2013.txt file in the <a href="https://github.com/ddesquens/ddesquens.github.io/tree/main/R%20projects/Moneyball">github repo</a>. You may need to reference this to understand what acronyms stand for.</p>
<p>We know from literature that on-base percentage (<code>OBP</code>) and slugging percentage (<code>SLG</code>) are better indicators of offensive success, so we’re calculating and adding them to our data, which is made of two data extracts that contain stats and salaries; we are merging them by <code>playerID</code> and <code>yearID</code>, illustrating a sample of the results as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># data prep</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#add features to data</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>batting<span class="sc">$</span>BA <span class="ot">&lt;-</span> batting<span class="sc">$</span>H <span class="sc">/</span> batting<span class="sc">$</span>AB</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>batting <span class="ot">&lt;-</span> batting <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">OBP =</span> (H<span class="sc">+</span>BB<span class="sc">+</span>HBP)<span class="sc">/</span>(AB<span class="sc">+</span>BB<span class="sc">+</span>HBP<span class="sc">+</span>SF))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>batting <span class="ot">&lt;-</span> batting <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">X1B =</span> H<span class="sc">-</span>X2B<span class="sc">-</span>X3B<span class="sc">-</span>HR)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>batting <span class="ot">&lt;-</span> batting <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">SLG =</span> (X1B <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>X2B <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>X3B <span class="sc">+</span> <span class="dv">4</span><span class="sc">*</span>HR)<span class="sc">/</span>AB)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#remove data from batting (salaries data set only have data from 1985 onwards)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>batting <span class="ot">&lt;-</span> batting <span class="sc">%&gt;%</span> <span class="fu">filter</span>(yearID<span class="sc">&gt;=</span><span class="dv">1985</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#merge both datasets batting and sal to combine player stats with salaries</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>excluded.fields <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'teamID'</span>,<span class="st">'lgID'</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>sal.excluding.fields <span class="ot">&lt;-</span> <span class="fu">select</span>(sal,<span class="sc">-</span><span class="fu">any_of</span>(excluded.fields))</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>combo <span class="ot">&lt;-</span> <span class="fu">merge</span>(batting,sal.excluding.fields,<span class="at">by=</span><span class="fu">c</span>(<span class="st">'playerID'</span>,<span class="st">'yearID'</span>))</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co">#show results</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(<span class="fu">arrange</span>(<span class="fu">select</span>(<span class="fu">filter</span>(combo,yearID<span class="sc">==</span><span class="dv">2001</span>),playerID,teamID,AB,OBP,SLG,salary),<span class="fu">desc</span>(OBP<span class="sc">*</span>AB))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   playerID teamID  AB       OBP       SLG   salary
1 suzukic01    SEA 692 0.3814714 0.4566474  5666667
2 gonzalu01    ARI 609 0.4285714 0.6880131  4833333
3 heltoto01    COL 587 0.4316547 0.6848382  4950000
4  sosasa01    CHN 577 0.4374121 0.7365685 12500000
5 rodrial01    TEX 632 0.3989071 0.6218354 22000000
6 berkmla01    HOU 577 0.4302326 0.6204506   305000</code></pre>
</div>
</div>
</section>
<section id="analyzing-the-lost-players-and-defining-criteria-for-the-search" class="level4">
<h4 class="anchored" data-anchor-id="analyzing-the-lost-players-and-defining-criteria-for-the-search"><strong>Analyzing the lost players and defining criteria for the search</strong></h4>
<p>Is there anything we can learn from the lost players?<br>
First of all let’s define the OA’s budget to sign 3 new players. As per the chart below, the total in salaries for them in 2001 amounted to $14.5M. We have a <strong>total budget</strong> of <strong>$15M</strong> to sign 3 new players.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># analyze lost players</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#get dataframe with 3 lost players</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>lost.players <span class="ot">&lt;-</span> combo <span class="sc">%&gt;%</span> <span class="fu">subset</span>(playerID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'giambja01'</span>,<span class="st">'damonjo01'</span>,<span class="st">'isrinja01'</span>))</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#visualize trend of salaries through years</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>trendsal.lostplayers <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">filter</span>(lost.players,yearID<span class="sc">&lt;</span><span class="dv">2003</span>),<span class="fu">aes</span>(yearID,<span class="fu">round</span>(salary<span class="sc">/</span><span class="fl">1e6</span>,<span class="dv">2</span>))) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group=</span>playerID,<span class="at">color=</span>playerID)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>playerID)) <span class="sc">+</span> <span class="fu">theme_calc</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y=</span><span class="st">'salary ($M)'</span>,<span class="at">x=</span><span class="st">'season'</span>,<span class="at">caption=</span><span class="st">'salary trend for the lost players up until 2002, after they moved to other teams in 2001'</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>trendsal.lostplayers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="moneyball_files/figure-html/lost-players-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Other than the budget constraint, what are other variables that we should be focusing on among the entire dataset?</p>
<p>Now we have all the information we need, let’s put together the following 3 constraints:</p>
<ul>
<li><p>The total combined salary of the three players can not exceed 15 million dollars.</p></li>
<li><p>Their combined number of At Bats (AB) needs to be equal to or greater than the lost players.</p></li>
<li><p>Their mean OBP had to be equal to or greater than the mean OBP of the lost players.</p></li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Salary cap = $15M 
AB combined = 1795 
OBP mean = 0.3771385</code></pre>
</div>
</div>
</section>
<section id="replacement-players" class="level4">
<h4 class="anchored" data-anchor-id="replacement-players"><strong>Replacement players</strong></h4>
<p>We have a pool of 604 players. The idea is to compute combinations of 3 players that meet the criteria defined and provide them in order of maximizing the stats <code>AB</code>, <code>OBP</code> and minimizing the <code>salary</code> paid.</p>
<p>For the sake of a relatively quick computing we are going to cut the pool of players down by picking the top 14 sample sorted by descending product <code>AB x OBP</code> and ascending <code>salary</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#reduce the dataframe to top 14</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>external.players <span class="ot">&lt;-</span> <span class="fu">head</span>(external.players,<span class="dv">14</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(external.players)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    playerID yearID teamID lgID  AB       OBP   salary
1  suzukic01   2001    SEA   AL 692 0.3814714  5666667
2  gonzalu01   2001    ARI   NL 609 0.4285714  4833333
3  heltoto01   2001    COL   NL 587 0.4316547  4950000
4  berkmla01   2001    HOU   NL 577 0.4302326   305000
5  bondsba01   2001    SFN   NL 476 0.5150602 10300000
6  jonesch06   2001    ATL   NL 572 0.4268833 10333333
7  bagweje01   2001    HOU   NL 600 0.3974895  6500000
8  alomaro01   2001    CLE   AL 575 0.4146707  7750000
9  pujolal01   2001    SLN   NL 590 0.4029630   200000
10 stewash01   2001    TOR   AL 640 0.3710602  2183333
11 biggicr01   2001    HOU   NL 617 0.3821478  7750000
12 aurilri01   2001    SFN   NL 636 0.3688047  3250000
13 pierrju01   2001    COL   NL 617 0.3781764   215000
14 gilesbr02   2001    PIT   NL 576 0.4035608  7333333</code></pre>
</div>
</div>
<p>Billy Beane has to sign any of the following combinations of 3 players to made it to the playoffs in the next season 2002 (sorted from cheapest to most expensive):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#go through combinations of 3 players and append those which satisfy the conditions to a dataframe ordering them from best to worse options</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> external.players</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>eligible.combinations <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>list.candidate.players <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>list.unique.players <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(p1 <span class="cf">in</span> df<span class="sc">$</span>playerID) {</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(p2 <span class="cf">in</span> df<span class="sc">$</span>playerID) {</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(p1<span class="sc">!=</span>p2) {</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(p3 <span class="cf">in</span> df<span class="sc">$</span>playerID) {</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(p1<span class="sc">!=</span>p3 <span class="sc">&amp;</span> p2<span class="sc">!=</span>p3) {</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>          <span class="co">#condition 1</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>          salary.players <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">filter</span>(df,playerID <span class="sc">%in%</span> <span class="fu">c</span>(p1,p2,p3))<span class="sc">$</span>salary)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>          c1 <span class="ot">&lt;-</span> salary.players <span class="sc">&lt;=</span> salary.cap<span class="sc">*</span><span class="fl">1e6</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>          <span class="co">#condition 2</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>          AB.players <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">filter</span>(df,playerID <span class="sc">%in%</span> <span class="fu">c</span>(p1,p2,p3))<span class="sc">$</span>AB)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>          c2 <span class="ot">&lt;-</span> AB.players <span class="sc">&gt;=</span> AB.min</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>          <span class="co">#condition 3</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>          OBP.players <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">filter</span>(df,playerID <span class="sc">%in%</span> <span class="fu">c</span>(p1,p2,p3))<span class="sc">$</span>OBP)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>          c3 <span class="ot">&lt;-</span> OBP.players <span class="sc">&gt;=</span> OBP.mean</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>          <span class="co">#check all</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(<span class="fu">all</span>(c1,c2,c3)) {</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>            candidate.players <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">sort</span>(<span class="fu">c</span>(p1,p2,p3)),<span class="at">collapse=</span><span class="st">" | "</span>)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>            list.unique.players <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">append</span>(list.unique.players, <span class="fu">c</span>(p1,p2,p3))))</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>            <span class="co">#check combination of players</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="sc">!</span>(candidate.players <span class="sc">%in%</span> list.candidate.players)) {</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>              eligible.combinations <span class="ot">&lt;-</span> <span class="fu">append</span>(eligible.combinations, <span class="fu">list</span>(<span class="fu">data.frame</span>(candidate.players,<span class="at">salary.total=</span>salary.players,<span class="at">AB.combined=</span>AB.players,<span class="at">OBP.mean=</span>OBP.players)))</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>              list.candidate.players <span class="ot">&lt;-</span> <span class="fu">append</span>(list.candidate.players,candidate.players)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>              n <span class="ot">&lt;-</span> n <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {<span class="cf">next</span>}</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {<span class="cf">next</span>}</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="co">#potential winning combinations of players to sign in</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>df.eligible.combinations <span class="ot">&lt;-</span> <span class="fu">arrange</span>(<span class="fu">rbindlist</span>(eligible.combinations),salary.total,<span class="fu">desc</span>(OBP.mean<span class="sc">*</span>AB.combined))</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df.eligible.combinations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     candidate.players salary.total AB.combined  OBP.mean
  1: pierrju01 | pujolal01 | stewash01      2598333        1847 0.3840665
  2: berkmla01 | pujolal01 | stewash01      2688333        1807 0.4014186
  3: berkmla01 | pierrju01 | stewash01      2703333        1834 0.3931564
  4: aurilri01 | pierrju01 | pujolal01      3665000        1843 0.3833147
  5: aurilri01 | berkmla01 | pujolal01      3755000        1803 0.4006667
 ---                                                                     
102: aurilri01 | bagweje01 | heltoto01     14700000        1823 0.3993163
103: alomaro01 | gonzalu01 | stewash01     14766666        1824 0.4047674
104: biggicr01 | gonzalu01 | stewash01     14766666        1866 0.3939265
105: alomaro01 | heltoto01 | stewash01     14883333        1802 0.4057952
106: biggicr01 | heltoto01 | stewash01     14883333        1844 0.3949542</code></pre>
</div>
</div>
<p>Organizing the winning combinations into a scatterplot divided in four quadrants we can gather more insight as to which are the best combinations taking into account that the size of dots represent the <code>salary.total</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate quadrants</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>x_mid <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="fu">max</span>(df.eligible.combinations<span class="sc">$</span>AB.combined, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">min</span>(df.eligible.combinations<span class="sc">$</span>AB.combined, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>y_mid <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="fu">max</span>(df.eligible.combinations<span class="sc">$</span>OBP.mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">min</span>(df.eligible.combinations<span class="sc">$</span>OBP.mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>plot.combinations <span class="ot">&lt;-</span> df.eligible.combinations <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quadrant =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  AB.combined <span class="sc">&gt;</span> x_mid <span class="sc">&amp;</span> OBP.mean <span class="sc">&gt;</span> y_mid <span class="sc">~</span> <span class="st">"Q1"</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  AB.combined <span class="sc">&lt;=</span> x_mid <span class="sc">&amp;</span> OBP.mean <span class="sc">&gt;</span> y_mid  <span class="sc">~</span> <span class="st">"Q2"</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  AB.combined <span class="sc">&lt;=</span> x_mid <span class="sc">&amp;</span> OBP.mean <span class="sc">&lt;=</span> y_mid <span class="sc">~</span> <span class="st">"Q3"</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Q4"</span>))</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">#plot winning combinations</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>scatterplot.combinations <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot.combinations, <span class="fu">aes</span>(AB.combined, OBP.mean,<span class="at">color=</span>quadrant,<span class="at">size=</span>salary.total)) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> x_mid) <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> y_mid) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.45</span>) <span class="sc">+</span> <span class="fu">theme_calc</span>()</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>scatterplot.combinations</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="moneyball_files/figure-html/winning-plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<!-- -->

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb10" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "MoneyBall"</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Helping Billy Beane (or Brad Pitt) to make it to the 2002 playoffs with the Oakland A's"</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "David Desquens"</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: paged</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="al">![](moneyball_title.jpg)</span>{fig-align="left"}</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="fu">## Context &amp; Background</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>*Source: [Wikipedia](https://en.wikipedia.org/wiki/Moneyball)*</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="fu">#### **Rules of Baseball**</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>You don't need to know much about Baseball to understand the analysis. If you're totally unfamiliar with Baseball, check out this <span class="co">[</span><span class="ot">useful explanatory video!</span><span class="co">](https://www.youtube.com/watch?v=0bKkGeROiPA)</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="fu">#### **The 2002 Oakland A's**</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>The Oakland Athletics' 2002 season was the team's 35th in Oakland, California. It was also the 102nd season in franchise history. The Athletics finished first in the American League West with a record of 103-59.</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>The Athletics' 2002 campaign ranks among the most famous in franchise history. Following the 2001 season, Oakland saw the departure of three key players (the lost boys). Billy Beane, the team's general manager, responded with a series of under-the-radar free agent signings. The new-look Athletics, despite a comparative lack of star power, surprised the baseball world by besting the 2001 team's regular season record. The team is most famous, however, for winning 20 consecutive games between August 13 and September 4, 2002. The Athletics' season was the subject of Michael Lewis' 2003 book Moneyball: The Art of Winning an Unfair Game (as Lewis was given the opportunity to follow the team around throughout that season).</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>This project is based off the book written by Michael Lewis (later turned into a movie - see <span class="co">[</span><span class="ot">the magic moment</span><span class="co">](https://youtu.be/yGf6LNWY9AI?si=zsLayKwV5YBw-Jqm)</span>).</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="fu">#### **Moneyball Book**</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>The central premise of book *Moneyball* is that the collective wisdom of baseball insiders (including players, managers, coaches, scouts, and the front office) over the past century is subjective and often flawed. Statistics such as stolen bases, runs batted in, and batting average, typically used to gauge players, are relics of a 19th-century view of the game and the statistics available at that time. The book argues that the Oakland A's' front office took advantage of more analytical gauges of player performance to field a team that could better compete against richer competitors in Major League Baseball (MLB).</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>Rigorous statistical analysis had demonstrated that on-base percentage and slugging percentage are better indicators of offensive success, and the A's became convinced that these qualities were cheaper to obtain on the open market than more historically valued qualities such as speed and contact. These observations often flew in the face of conventional baseball wisdom and the beliefs of many baseball scouts and executives.</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>By re-evaluating the strategies that produce wins on the field, the 2002 Athletics, with approximately US 44 million dollars in salary, were competitive with larger market teams such as the New York Yankees, who spent over US\$125 million in payroll that same season.</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="al">![](salary.png)</span>{fig-align="center"}</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>Because of the team's smaller revenues, Oakland is forced to find players undervalued by the market, and their system for finding value in undervalued players has proven itself thus far. This approach brought the A's to the playoffs in 2002 and 2003.</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>In this project we'll work with some data and with the goal of trying to find replacement players for the ones lost at the start of the off-season - During the 2001--02 offseason, the team lost three key free agents to larger market teams: 2000 AL MVP Jason Giambi to the New York Yankees, outfielder Johnny Damon to the Boston Red Sox, and closer Jason Isringhausen to the St. Louis Cardinals.</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a><span class="fu">## Let's get started!</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>The main goal of this project is to help the Oakland A's recruit under-valued players!</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a><span class="al">![](Moneyball.jpg)</span>{fig-align="center"}</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a><span class="fu">#### **Data prep**</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>We'll be using data from <span class="co">[</span><span class="ot">Sean Lahaman's Website</span><span class="co">](http://www.seanlahman.com)</span> a very useful source for baseball statistics. The documentation for the csv files that we will be using is located in the readme2013.txt file in the <span class="co">[</span><span class="ot">github repo</span><span class="co">](https://github.com/ddesquens/ddesquens.github.io/tree/main/R%20projects/Moneyball)</span>. You may need to reference this to understand what acronyms stand for.</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-packages-data-inputs</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a><span class="co"># libraries &amp; inputs</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a><span class="co">#libraries</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a><span class="co">#data inputs</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>batting <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'Batting.csv'</span>)</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>sal <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'Salaries.csv'</span>)</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>We know from literature that on-base percentage (<span class="in">`OBP`</span>) and slugging percentage (<span class="in">`SLG`</span>) are better indicators of offensive success, so we're calculating and adding them to our data, which is made of two data extracts that contain stats and salaries; we are merging them by <span class="in">`playerID`</span> and <span class="in">`yearID`</span>, illustrating a sample of the results as follows:</span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data-prep</span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a><span class="co"># data prep</span></span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a><span class="co">#add features to data</span></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>batting<span class="sc">$</span>BA <span class="ot">&lt;-</span> batting<span class="sc">$</span>H <span class="sc">/</span> batting<span class="sc">$</span>AB</span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>batting <span class="ot">&lt;-</span> batting <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">OBP =</span> (H<span class="sc">+</span>BB<span class="sc">+</span>HBP)<span class="sc">/</span>(AB<span class="sc">+</span>BB<span class="sc">+</span>HBP<span class="sc">+</span>SF))</span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>batting <span class="ot">&lt;-</span> batting <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">X1B =</span> H<span class="sc">-</span>X2B<span class="sc">-</span>X3B<span class="sc">-</span>HR)</span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>batting <span class="ot">&lt;-</span> batting <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">SLG =</span> (X1B <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>X2B <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>X3B <span class="sc">+</span> <span class="dv">4</span><span class="sc">*</span>HR)<span class="sc">/</span>AB)</span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a><span class="co">#remove data from batting (salaries data set only have data from 1985 onwards)</span></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>batting <span class="ot">&lt;-</span> batting <span class="sc">%&gt;%</span> <span class="fu">filter</span>(yearID<span class="sc">&gt;=</span><span class="dv">1985</span>)</span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a><span class="co">#merge both datasets batting and sal to combine player stats with salaries</span></span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a>excluded.fields <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'teamID'</span>,<span class="st">'lgID'</span>)</span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>sal.excluding.fields <span class="ot">&lt;-</span> <span class="fu">select</span>(sal,<span class="sc">-</span><span class="fu">any_of</span>(excluded.fields))</span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a>combo <span class="ot">&lt;-</span> <span class="fu">merge</span>(batting,sal.excluding.fields,<span class="at">by=</span><span class="fu">c</span>(<span class="st">'playerID'</span>,<span class="st">'yearID'</span>))</span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a><span class="co">#show results</span></span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(<span class="fu">arrange</span>(<span class="fu">select</span>(<span class="fu">filter</span>(combo,yearID<span class="sc">==</span><span class="dv">2001</span>),playerID,teamID,AB,OBP,SLG,salary),<span class="fu">desc</span>(OBP<span class="sc">*</span>AB))))</span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: adhoc-calc</span></span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a>total.salaries <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">sum</span>((combo <span class="sc">%&gt;%</span> <span class="fu">subset</span>(playerID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'giambja01'</span>,<span class="st">'damonjo01'</span>,<span class="st">'isrinja01'</span>) <span class="sc">&amp;</span> yearID<span class="sc">==</span><span class="dv">2001</span>))<span class="sc">$</span>salary)<span class="sc">/</span><span class="fl">1e6</span>,<span class="dv">1</span>)</span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a><span class="fu">#### **Analyzing the lost players and defining criteria for the search**</span></span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a>Is there anything we can learn from the lost players?\</span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a>First of all let's define the OA's budget to sign 3 new players. As per the chart below, the total in salaries for them in 2001 amounted to \$<span class="in">`r total.salaries`</span>M. We have a **total budget** of **\$15M** to sign 3 new players.</span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lost-players</span></span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a><span class="co"># analyze lost players</span></span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a><span class="co">#get dataframe with 3 lost players</span></span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a>lost.players <span class="ot">&lt;-</span> combo <span class="sc">%&gt;%</span> <span class="fu">subset</span>(playerID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'giambja01'</span>,<span class="st">'damonjo01'</span>,<span class="st">'isrinja01'</span>))</span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a><span class="co">#visualize trend of salaries through years</span></span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a>trendsal.lostplayers <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">filter</span>(lost.players,yearID<span class="sc">&lt;</span><span class="dv">2003</span>),<span class="fu">aes</span>(yearID,<span class="fu">round</span>(salary<span class="sc">/</span><span class="fl">1e6</span>,<span class="dv">2</span>))) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group=</span>playerID,<span class="at">color=</span>playerID)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>playerID)) <span class="sc">+</span> <span class="fu">theme_calc</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y=</span><span class="st">'salary ($M)'</span>,<span class="at">x=</span><span class="st">'season'</span>,<span class="at">caption=</span><span class="st">'salary trend for the lost players up until 2002, after they moved to other teams in 2001'</span>)</span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a>trendsal.lostplayers</span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a>Other than the budget constraint, what are other variables that we should be focusing on among the entire dataset?</span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lost-player-stats</span></span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true" tabindex="-1"></a><span class="co">#concentrating on the pre-season 2002 data (that is from season 2001)</span></span>
<span id="cb10-148"><a href="#cb10-148" aria-hidden="true" tabindex="-1"></a>lost.players<span class="fl">.2001</span> <span class="ot">&lt;-</span> lost.players <span class="sc">%&gt;%</span> <span class="fu">filter</span>(yearID<span class="sc">==</span><span class="dv">2001</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(playerID,H,X2B,X3B,HR,OBP,SLG,BA,AB,salary)</span>
<span id="cb10-149"><a href="#cb10-149" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lost.players<span class="fl">.2001</span>)</span>
<span id="cb10-150"><a href="#cb10-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-151"><a href="#cb10-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-152"><a href="#cb10-152" aria-hidden="true" tabindex="-1"></a>Now we have all the information we need, let's put together the following 3 constraints:</span>
<span id="cb10-153"><a href="#cb10-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-154"><a href="#cb10-154" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The total combined salary of the three players can not exceed 15 million dollars.</span>
<span id="cb10-155"><a href="#cb10-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-156"><a href="#cb10-156" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Their combined number of At Bats (AB) needs to be equal to or greater than the lost players.</span>
<span id="cb10-157"><a href="#cb10-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-158"><a href="#cb10-158" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Their mean OBP had to be equal to or greater than the mean OBP of the lost players.</span>
<span id="cb10-159"><a href="#cb10-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-constraints</span></span>
<span id="cb10-164"><a href="#cb10-164" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb10-165"><a href="#cb10-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true" tabindex="-1"></a><span class="co">#calculating constraints</span></span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true" tabindex="-1"></a>salary.cap <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(total.salaries)</span>
<span id="cb10-168"><a href="#cb10-168" aria-hidden="true" tabindex="-1"></a>AB.min <span class="ot">&lt;-</span> <span class="fu">sum</span>(lost.players<span class="fl">.2001</span><span class="sc">$</span>AB)</span>
<span id="cb10-169"><a href="#cb10-169" aria-hidden="true" tabindex="-1"></a>OBP.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(lost.players<span class="fl">.2001</span><span class="sc">$</span>OBP)</span>
<span id="cb10-170"><a href="#cb10-170" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Salary cap ="</span>, <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, <span class="fu">paste</span>(<span class="st">"$"</span>, salary.cap, <span class="st">"M"</span>)),<span class="st">"</span><span class="sc">\n</span><span class="st">AB combined ="</span>, AB.min,<span class="st">"</span><span class="sc">\n</span><span class="st">OBP mean ="</span>, <span class="fu">round</span>(OBP.mean,<span class="dv">7</span>))</span>
<span id="cb10-171"><a href="#cb10-171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-172"><a href="#cb10-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-173"><a href="#cb10-173" aria-hidden="true" tabindex="-1"></a><span class="fu">#### **Replacement players**</span></span>
<span id="cb10-174"><a href="#cb10-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-177"><a href="#cb10-177" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-178"><a href="#cb10-178" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pool-players</span></span>
<span id="cb10-179"><a href="#cb10-179" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb10-180"><a href="#cb10-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-181"><a href="#cb10-181" aria-hidden="true" tabindex="-1"></a><span class="co">#get a dataframe with 2001 players excluding the 3 who left and the ones in the OAK team</span></span>
<span id="cb10-182"><a href="#cb10-182" aria-hidden="true" tabindex="-1"></a>external.players <span class="ot">&lt;-</span> combo <span class="sc">%&gt;%</span> <span class="fu">subset</span>(yearID<span class="sc">==</span><span class="dv">2001</span> <span class="sc">&amp;</span> <span class="sc">!</span>(playerID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'giambja01'</span>,<span class="st">'damonjo01'</span>,<span class="st">'isrinja01'</span>)) <span class="sc">&amp;</span> (teamID <span class="sc">!=</span> <span class="st">'OAK'</span>) <span class="sc">&amp;</span> salary <span class="sc">&lt;</span> salary.cap<span class="sc">*</span><span class="fl">1e6</span><span class="dv">-2</span><span class="sc">*</span>(<span class="fu">quantile</span>(combo<span class="sc">$</span>salary)[<span class="dv">4</span>]) <span class="sc">&amp;</span> <span class="sc">!</span>(<span class="fu">is.na</span>(salary)) <span class="sc">&amp;</span> <span class="sc">!</span>(<span class="fu">is.na</span>(AB)) <span class="sc">&amp;</span> <span class="sc">!</span>(<span class="fu">is.na</span>(OBP)) <span class="sc">&amp;</span> OBP <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> AB <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb10-183"><a href="#cb10-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-184"><a href="#cb10-184" aria-hidden="true" tabindex="-1"></a><span class="co">#arrange dataframe and calculate initial pool of players</span></span>
<span id="cb10-185"><a href="#cb10-185" aria-hidden="true" tabindex="-1"></a>external.players <span class="ot">&lt;-</span> external.players <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(OBP<span class="sc">*</span>AB),salary) <span class="sc">%&gt;%</span> <span class="fu">select</span>(playerID,yearID,teamID,lgID,AB,OBP,salary)</span>
<span id="cb10-186"><a href="#cb10-186" aria-hidden="true" tabindex="-1"></a>pool.players <span class="ot">&lt;-</span> <span class="fu">nrow</span>(external.players)</span>
<span id="cb10-187"><a href="#cb10-187" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-188"><a href="#cb10-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-189"><a href="#cb10-189" aria-hidden="true" tabindex="-1"></a>We have a pool of <span class="in">`r pool.players`</span> players. The idea is to compute combinations of 3 players that meet the criteria defined and provide them in order of maximizing the stats <span class="in">`AB`</span>, <span class="in">`OBP`</span> and minimizing the <span class="in">`salary`</span> paid.</span>
<span id="cb10-190"><a href="#cb10-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-191"><a href="#cb10-191" aria-hidden="true" tabindex="-1"></a>For the sake of a relatively quick computing we are going to cut the pool of players down by picking the top 14 sample sorted by descending product <span class="in">`AB x OBP`</span> and ascending <span class="in">`salary`</span>.</span>
<span id="cb10-192"><a href="#cb10-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-195"><a href="#cb10-195" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-196"><a href="#cb10-196" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pool-reduction</span></span>
<span id="cb10-197"><a href="#cb10-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-198"><a href="#cb10-198" aria-hidden="true" tabindex="-1"></a><span class="co">#reduce the dataframe to top 14</span></span>
<span id="cb10-199"><a href="#cb10-199" aria-hidden="true" tabindex="-1"></a>external.players <span class="ot">&lt;-</span> <span class="fu">head</span>(external.players,<span class="dv">14</span>)</span>
<span id="cb10-200"><a href="#cb10-200" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(external.players)</span>
<span id="cb10-201"><a href="#cb10-201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-202"><a href="#cb10-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-203"><a href="#cb10-203" aria-hidden="true" tabindex="-1"></a>Billy Beane has to sign any of the following combinations of 3 players to made it to the playoffs in the next season 2002 (sorted from cheapest to most expensive):</span>
<span id="cb10-204"><a href="#cb10-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-207"><a href="#cb10-207" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-208"><a href="#cb10-208" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: loop-computing</span></span>
<span id="cb10-209"><a href="#cb10-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-210"><a href="#cb10-210" aria-hidden="true" tabindex="-1"></a><span class="co">#go through combinations of 3 players and append those which satisfy the conditions to a dataframe ordering them from best to worse options</span></span>
<span id="cb10-211"><a href="#cb10-211" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> external.players</span>
<span id="cb10-212"><a href="#cb10-212" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb10-213"><a href="#cb10-213" aria-hidden="true" tabindex="-1"></a>eligible.combinations <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb10-214"><a href="#cb10-214" aria-hidden="true" tabindex="-1"></a>list.candidate.players <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb10-215"><a href="#cb10-215" aria-hidden="true" tabindex="-1"></a>list.unique.players <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb10-216"><a href="#cb10-216" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(p1 <span class="cf">in</span> df<span class="sc">$</span>playerID) {</span>
<span id="cb10-217"><a href="#cb10-217" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(p2 <span class="cf">in</span> df<span class="sc">$</span>playerID) {</span>
<span id="cb10-218"><a href="#cb10-218" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(p1<span class="sc">!=</span>p2) {</span>
<span id="cb10-219"><a href="#cb10-219" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(p3 <span class="cf">in</span> df<span class="sc">$</span>playerID) {</span>
<span id="cb10-220"><a href="#cb10-220" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(p1<span class="sc">!=</span>p3 <span class="sc">&amp;</span> p2<span class="sc">!=</span>p3) {</span>
<span id="cb10-221"><a href="#cb10-221" aria-hidden="true" tabindex="-1"></a>          <span class="co">#condition 1</span></span>
<span id="cb10-222"><a href="#cb10-222" aria-hidden="true" tabindex="-1"></a>          salary.players <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">filter</span>(df,playerID <span class="sc">%in%</span> <span class="fu">c</span>(p1,p2,p3))<span class="sc">$</span>salary)</span>
<span id="cb10-223"><a href="#cb10-223" aria-hidden="true" tabindex="-1"></a>          c1 <span class="ot">&lt;-</span> salary.players <span class="sc">&lt;=</span> salary.cap<span class="sc">*</span><span class="fl">1e6</span></span>
<span id="cb10-224"><a href="#cb10-224" aria-hidden="true" tabindex="-1"></a>          <span class="co">#condition 2</span></span>
<span id="cb10-225"><a href="#cb10-225" aria-hidden="true" tabindex="-1"></a>          AB.players <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">filter</span>(df,playerID <span class="sc">%in%</span> <span class="fu">c</span>(p1,p2,p3))<span class="sc">$</span>AB)</span>
<span id="cb10-226"><a href="#cb10-226" aria-hidden="true" tabindex="-1"></a>          c2 <span class="ot">&lt;-</span> AB.players <span class="sc">&gt;=</span> AB.min</span>
<span id="cb10-227"><a href="#cb10-227" aria-hidden="true" tabindex="-1"></a>          <span class="co">#condition 3</span></span>
<span id="cb10-228"><a href="#cb10-228" aria-hidden="true" tabindex="-1"></a>          OBP.players <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">filter</span>(df,playerID <span class="sc">%in%</span> <span class="fu">c</span>(p1,p2,p3))<span class="sc">$</span>OBP)</span>
<span id="cb10-229"><a href="#cb10-229" aria-hidden="true" tabindex="-1"></a>          c3 <span class="ot">&lt;-</span> OBP.players <span class="sc">&gt;=</span> OBP.mean</span>
<span id="cb10-230"><a href="#cb10-230" aria-hidden="true" tabindex="-1"></a>          <span class="co">#check all</span></span>
<span id="cb10-231"><a href="#cb10-231" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(<span class="fu">all</span>(c1,c2,c3)) {</span>
<span id="cb10-232"><a href="#cb10-232" aria-hidden="true" tabindex="-1"></a>            candidate.players <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">sort</span>(<span class="fu">c</span>(p1,p2,p3)),<span class="at">collapse=</span><span class="st">" | "</span>)</span>
<span id="cb10-233"><a href="#cb10-233" aria-hidden="true" tabindex="-1"></a>            list.unique.players <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">append</span>(list.unique.players, <span class="fu">c</span>(p1,p2,p3))))</span>
<span id="cb10-234"><a href="#cb10-234" aria-hidden="true" tabindex="-1"></a>            <span class="co">#check combination of players</span></span>
<span id="cb10-235"><a href="#cb10-235" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="sc">!</span>(candidate.players <span class="sc">%in%</span> list.candidate.players)) {</span>
<span id="cb10-236"><a href="#cb10-236" aria-hidden="true" tabindex="-1"></a>              eligible.combinations <span class="ot">&lt;-</span> <span class="fu">append</span>(eligible.combinations, <span class="fu">list</span>(<span class="fu">data.frame</span>(candidate.players,<span class="at">salary.total=</span>salary.players,<span class="at">AB.combined=</span>AB.players,<span class="at">OBP.mean=</span>OBP.players)))</span>
<span id="cb10-237"><a href="#cb10-237" aria-hidden="true" tabindex="-1"></a>              list.candidate.players <span class="ot">&lt;-</span> <span class="fu">append</span>(list.candidate.players,candidate.players)</span>
<span id="cb10-238"><a href="#cb10-238" aria-hidden="true" tabindex="-1"></a>              n <span class="ot">&lt;-</span> n <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb10-239"><a href="#cb10-239" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-240"><a href="#cb10-240" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb10-241"><a href="#cb10-241" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {<span class="cf">next</span>}</span>
<span id="cb10-242"><a href="#cb10-242" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-243"><a href="#cb10-243" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {<span class="cf">next</span>}</span>
<span id="cb10-244"><a href="#cb10-244" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-245"><a href="#cb10-245" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-246"><a href="#cb10-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-247"><a href="#cb10-247" aria-hidden="true" tabindex="-1"></a><span class="co">#potential winning combinations of players to sign in</span></span>
<span id="cb10-248"><a href="#cb10-248" aria-hidden="true" tabindex="-1"></a>df.eligible.combinations <span class="ot">&lt;-</span> <span class="fu">arrange</span>(<span class="fu">rbindlist</span>(eligible.combinations),salary.total,<span class="fu">desc</span>(OBP.mean<span class="sc">*</span>AB.combined))</span>
<span id="cb10-249"><a href="#cb10-249" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df.eligible.combinations)</span>
<span id="cb10-250"><a href="#cb10-250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-251"><a href="#cb10-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-252"><a href="#cb10-252" aria-hidden="true" tabindex="-1"></a>Organizing the winning combinations into a scatterplot divided in four quadrants we can gather more insight as to which are the best combinations taking into account that the size of dots represent the <span class="in">`salary.total`</span>.</span>
<span id="cb10-255"><a href="#cb10-255" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-256"><a href="#cb10-256" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: winning-plot</span></span>
<span id="cb10-257"><a href="#cb10-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-258"><a href="#cb10-258" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate quadrants</span></span>
<span id="cb10-259"><a href="#cb10-259" aria-hidden="true" tabindex="-1"></a>x_mid <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="fu">max</span>(df.eligible.combinations<span class="sc">$</span>AB.combined, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb10-260"><a href="#cb10-260" aria-hidden="true" tabindex="-1"></a>                <span class="fu">min</span>(df.eligible.combinations<span class="sc">$</span>AB.combined, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb10-261"><a href="#cb10-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-262"><a href="#cb10-262" aria-hidden="true" tabindex="-1"></a>y_mid <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="fu">max</span>(df.eligible.combinations<span class="sc">$</span>OBP.mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb10-263"><a href="#cb10-263" aria-hidden="true" tabindex="-1"></a>                <span class="fu">min</span>(df.eligible.combinations<span class="sc">$</span>OBP.mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb10-264"><a href="#cb10-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-265"><a href="#cb10-265" aria-hidden="true" tabindex="-1"></a>plot.combinations <span class="ot">&lt;-</span> df.eligible.combinations <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quadrant =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-266"><a href="#cb10-266" aria-hidden="true" tabindex="-1"></a>  AB.combined <span class="sc">&gt;</span> x_mid <span class="sc">&amp;</span> OBP.mean <span class="sc">&gt;</span> y_mid <span class="sc">~</span> <span class="st">"Q1"</span>,</span>
<span id="cb10-267"><a href="#cb10-267" aria-hidden="true" tabindex="-1"></a>  AB.combined <span class="sc">&lt;=</span> x_mid <span class="sc">&amp;</span> OBP.mean <span class="sc">&gt;</span> y_mid  <span class="sc">~</span> <span class="st">"Q2"</span>,</span>
<span id="cb10-268"><a href="#cb10-268" aria-hidden="true" tabindex="-1"></a>  AB.combined <span class="sc">&lt;=</span> x_mid <span class="sc">&amp;</span> OBP.mean <span class="sc">&lt;=</span> y_mid <span class="sc">~</span> <span class="st">"Q3"</span>,</span>
<span id="cb10-269"><a href="#cb10-269" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Q4"</span>))</span>
<span id="cb10-270"><a href="#cb10-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-271"><a href="#cb10-271" aria-hidden="true" tabindex="-1"></a><span class="co">#plot winning combinations</span></span>
<span id="cb10-272"><a href="#cb10-272" aria-hidden="true" tabindex="-1"></a>scatterplot.combinations <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot.combinations, <span class="fu">aes</span>(AB.combined, OBP.mean,<span class="at">color=</span>quadrant,<span class="at">size=</span>salary.total)) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> x_mid) <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> y_mid) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.45</span>) <span class="sc">+</span> <span class="fu">theme_calc</span>()</span>
<span id="cb10-273"><a href="#cb10-273" aria-hidden="true" tabindex="-1"></a>scatterplot.combinations</span>
<span id="cb10-274"><a href="#cb10-274" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>